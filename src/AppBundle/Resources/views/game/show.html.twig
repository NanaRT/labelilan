{% extends 'base.html.twig' %}

{% block body %}
    <div class="container">
        <div class="row">
            <!-- Blog Post Content Column -->
            <div class="col-md-8">
                <h1>{{game.name}}</h1>
                <p class="lead">
                	{{game.category.name}} organisé par <a href="{{ path('informations') }}#{{game.organizer.systName}}">{{game.organizer.name}}</a>
                </p>
                <hr>
                <img src="{{ asset('bundles/app/img/game/'~game.systName~'.png') }}" alt="{{game.name}}" class="img-responsive" >
                <hr>
                <p>
                	{{game.description}}
                </p>

            </div>

            <div class="col-md-4">
                <div class="well">
                    <div class="input-group">
	                	<h4>
	                		Places
	                	</h4>
	                	{%if game.category.systName == 'multi' %}
	                		Nb places équipes restantes : {{ searchCategoryService.getMultiPlaces(game.id) }}
	                	{% elseif game.category.systName == 'solo'
	                	and game.places%}
	                		Nb places restantes : {{ searchCategoryService.getSoloPlaces(game.id) }}
	                	{% else%}
							Nb personnes intéressées : {{ searchCategoryService.getNumberPlayer(game.id) }}
	                    {%endif%} 
	                    <br>
	                    {% if (is_granted("IS_AUTHENTICATED_REMEMBERED")) %} 
	                    	{% if  (game.category.systName == 'multi' or game.category.systName == 'solo')%}
								{%if searchCategoryService.checkPlaces(game.id) == 1
								and searchCategoryService.getCreatedPlayer(app.user.id, game.id) == 0%}
				                    <a class="btn btn-default" href="{{path('player_new', {'userId':app.user.id, 'gameId':game.id}) }}" >
				                    	 <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> S'inscrire
				                    </a>
				                {%else%}
				                    <a class="btn btn-default disabled" href="{{path('player_new', {'userId':app.user.id, 'gameId':game.id}) }}" >
				                    	 Inscrit
				                    </a>
				                {%endif%}
							{% elseif game.category.systName == 'autre'
							or game.category.systName == 'libre'%}
								{%if searchCategoryService.getCreatedPlayer(app.user.id, game.id) == 0%}
				                    <a class="btn btn-default" href="{{path('new_free_player', {'userId':app.user.id, 'gameId':game.id}) }}" >
				                    	 <span class="glyphicon glyphicon-star" aria-hidden="true"></span> Intéréssé
				                    </a>
				                {%else%}
				                    <a class="btn btn-default disabled" href="{{path('new_free_player', {'userId':app.user.id, 'gameId':game.id}) }}" >
				                    	 Intéréssé
				                    </a>
				                {%endif%}
				            {%endif%}
			            {%endif%}
                    </div>
                </div>

                {% if (is_granted("IS_AUTHENTICATED_REMEMBERED")) %} 
	            	{% if  (game.category.systName == 'multi')   %}
	            		{%for player in searchCategoryService.getPlayerGame(app.user.id, game.id)%}
							{%if player.team 
							and player.team.validation is null 
							and player.capitain%}
				                <div class="well">  
				                	<a href="{{path('user_recruit', {'gameId':game.id}) }}" >
				                		<h4>
				                		Rechercher joueurs
				                		</h4>
				                	</a>
				                	<table class="table table-hover">
				                		<tbody>
						                	{%for soloPlayers in searchCategoryService.searchSoloPlayers(game.id)%}
						                		<tr id="searchTr">
						                			<td>
						                				{{soloPlayers.pseudo}}
						                			</td>
						                			<td align="right">
						                				{%if searchCategoryService.checkApplication(app.user.id, soloPlayers.user.id,game.id,'team')%}
										                	<a class="btn btn-default" href="{{path('application_new', searchCategoryService.newApplicationTeamArray(app.user.id,soloPlayers.user.id,game.id,'team')) }}" >
										                    	 <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Recruter
										                    </a>
										                {%else%}
										                	<a class="btn btn-default disabled" href="{{path('application_new', searchCategoryService.newApplicationTeamArray(app.user.id,soloPlayers.user.id,game.id,'team')) }}" >
										                    	 Attente réponse
										                    </a>
										                {%endif%}
						                			</td>
						                		</tr>
						                	{%endfor%}
						                </tbody>
				                	</table>
				                </div>
							{%else%}	            			
				                <div class="well">  
				                	<h4>Créer team</h4>
				                	<a class="btn btn-default" href="{{path('team_new', {'user':app.user.id, 'game':game.id}) }}" >
				                    	 <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Créer une équipe
				                    </a>
				                </div>
				            {%endif%}
			            {%endfor%}
                	{%endif%}
                {%endif%}
            </div>
    	</div>

		{% if is_granted("ROLE_ADMIN") %}
	        {{ form_start(delete_form) }}
	            <input class="btn btn-default" type="submit" value="Delete">
	        {{ form_end(delete_form) }}
	    {%endif%}
    </div>
    
{% endblock %}
